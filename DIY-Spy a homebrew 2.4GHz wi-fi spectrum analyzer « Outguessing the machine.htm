<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>DIY-Spy: a homebrew 2.4GHz wi-fi spectrum analyzer «  Outguessing the machine</title>

<link rel="stylesheet" href="DIY-Spy%20a%20homebrew%202.4GHz%20wi-fi%20spectrum%20analyzer%20%C2%AB%20Outguessing%20the%20machine_files/style.css" type="text/css" media="screen">
<link rel="alternate" type="application/rss+xml" title="Outguessing the machine RSS Feed" href="https://tim.cexx.org/?feed=rss2">
<link rel="alternate" type="application/atom+xml" title="Outguessing the machine Atom Feed" href="https://tim.cexx.org/?feed=atom">
<link rel="pingback" href="https://tim.cexx.org/xmlrpc.php">


<meta name="robots" content="max-image-preview:large">
<link rel="alternate" type="application/rss+xml" title="Outguessing the machine » DIY-Spy: a homebrew 2.4GHz wi-fi spectrum analyzer Comments Feed" href="https://tim.cexx.org/?feed=rss2&amp;p=646">
<script type="text/javascript">
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/14.0.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/14.0.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/tim.cexx.org\/wp-includes\/js\/wp-emoji-release.min.js?ver=6.3.1"}};
/*! This file is auto-generated */
!function(i,n){var o,s,e;function c(e){try{var t={supportTests:e,timestamp:(new Date).valueOf()};sessionStorage.setItem(o,JSON.stringify(t))}catch(e){}}function p(e,t,n){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);var t=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data),r=(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(n,0,0),new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data));return t.every(function(e,t){return e===r[t]})}function u(e,t,n){switch(t){case"flag":return n(e,"\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f","\ud83c\udff3\ufe0f\u200b\u26a7\ufe0f")?!1:!n(e,"\ud83c\uddfa\ud83c\uddf3","\ud83c\uddfa\u200b\ud83c\uddf3")&&!n(e,"\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f","\ud83c\udff4\u200b\udb40\udc67\u200b\udb40\udc62\u200b\udb40\udc65\u200b\udb40\udc6e\u200b\udb40\udc67\u200b\udb40\udc7f");case"emoji":return!n(e,"\ud83e\udef1\ud83c\udffb\u200d\ud83e\udef2\ud83c\udfff","\ud83e\udef1\ud83c\udffb\u200b\ud83e\udef2\ud83c\udfff")}return!1}function f(e,t,n){var r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?new OffscreenCanvas(300,150):i.createElement("canvas"),a=r.getContext("2d",{willReadFrequently:!0}),o=(a.textBaseline="top",a.font="600 32px Arial",{});return e.forEach(function(e){o[e]=t(a,e,n)}),o}function t(e){var t=i.createElement("script");t.src=e,t.defer=!0,i.head.appendChild(t)}"undefined"!=typeof Promise&&(o="wpEmojiSettingsSupports",s=["flag","emoji"],n.supports={everything:!0,everythingExceptFlag:!0},e=new Promise(function(e){i.addEventListener("DOMContentLoaded",e,{once:!0})}),new Promise(function(t){var n=function(){try{var e=JSON.parse(sessionStorage.getItem(o));if("object"==typeof e&&"number"==typeof e.timestamp&&(new Date).valueOf()<e.timestamp+604800&&"object"==typeof e.supportTests)return e.supportTests}catch(e){}return null}();if(!n){if("undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof URL&&URL.createObjectURL&&"undefined"!=typeof Blob)try{var e="postMessage("+f.toString()+"("+[JSON.stringify(s),u.toString(),p.toString()].join(",")+"));",r=new Blob([e],{type:"text/javascript"}),a=new Worker(URL.createObjectURL(r),{name:"wpTestEmojiSupports"});return void(a.onmessage=function(e){c(n=e.data),a.terminate(),t(n)})}catch(e){}c(n=f(s,u,p))}t(n)}).then(function(e){for(var t in e)n.supports[t]=e[t],n.supports.everything=n.supports.everything&&n.supports[t],"flag"!==t&&(n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&n.supports[t]);n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&!n.supports.flag,n.DOMReady=!1,n.readyCallback=function(){n.DOMReady=!0}}).then(function(){return e}).then(function(){var e;n.supports.everything||(n.readyCallback(),(e=n.source||{}).concatemoji?t(e.concatemoji):e.wpemoji&&e.twemoji&&(t(e.twemoji),t(e.wpemoji)))}))}((window,document),window._wpemojiSettings);
</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 0.07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel="stylesheet" id="wp-block-library-css" href="DIY-Spy%20a%20homebrew%202.4GHz%20wi-fi%20spectrum%20analyzer%20%C2%AB%20Outguessing%20the%20machine_files/style.min.css" type="text/css" media="all">
<style id="classic-theme-styles-inline-css" type="text/css">
/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}
</style>
<style id="global-styles-inline-css" type="text/css">
body{--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flow > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}body .is-layout-flow > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}body .is-layout-flow > .aligncenter{margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}body .is-layout-constrained > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}body .is-layout-constrained > .aligncenter{margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > :where(:not(.alignleft):not(.alignright):not(.alignfull)){max-width: var(--wp--style--global--content-size);margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > .alignwide{max-width: var(--wp--style--global--wide-size);}body .is-layout-flex{display: flex;}body .is-layout-flex{flex-wrap: wrap;align-items: center;}body .is-layout-flex > *{margin: 0;}body .is-layout-grid{display: grid;}body .is-layout-grid > *{margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
.wp-block-navigation a:where(:not(.wp-element-button)){color: inherit;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
.wp-block-pullquote{font-size: 1.5em;line-height: 1.6;}
</style>
<script type="text/javascript" src="DIY-Spy%20a%20homebrew%202.4GHz%20wi-fi%20spectrum%20analyzer%20%C2%AB%20Outguessing%20the%20machine_files/jquery.min.js" id="jquery-core-js"></script>
<script type="text/javascript" src="DIY-Spy%20a%20homebrew%202.4GHz%20wi-fi%20spectrum%20analyzer%20%C2%AB%20Outguessing%20the%20machine_files/jquery-migrate.min.js" id="jquery-migrate-js"></script>
<link rel="https://api.w.org/" href="https://tim.cexx.org/index.php?rest_route=/"><link rel="alternate" type="application/json" href="https://tim.cexx.org/index.php?rest_route=/wp/v2/posts/646"><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://tim.cexx.org/xmlrpc.php?rsd">
<meta name="generator" content="WordPress 6.3.1">
<link rel="canonical" href="https://tim.cexx.org/?p=646">
<link rel="shortlink" href="https://tim.cexx.org/?p=646">
<link rel="alternate" type="application/json+oembed" href="https://tim.cexx.org/index.php?rest_route=%2Foembed%2F1.0%2Fembed&amp;url=https%3A%2F%2Ftim.cexx.org%2F%3Fp%3D646">
<link rel="alternate" type="text/xml+oembed" href="https://tim.cexx.org/index.php?rest_route=%2Foembed%2F1.0%2Fembed&amp;url=https%3A%2F%2Ftim.cexx.org%2F%3Fp%3D646&amp;format=xml">
		<style type="text/css" id="wp-custom-css">
			img {
  max-width: 100%;
  height: auto;
}		</style>
		
<script type="text/javascript" src="DIY-Spy%20a%20homebrew%202.4GHz%20wi-fi%20spectrum%20analyzer%20%C2%AB%20Outguessing%20the%20machine_files/jscripts.php"></script> 
<link href="data:text/css,%5Bid*%3D'google_ads_iframe'%5D%2C%5Bid*%3D'taboola-'%5D%2C.taboolaHeight%2C.taboola-placeholder%2C%23credential_picker_container%2C%23credentials-picker-container%2C%23credential_picker_iframe%2C%5Bid*%3D'google-one-tap-iframe'%5D%2C%23google-one-tap-popup-container%2C.google-one-tap-modal-div%2C%23amp_floatingAdDiv%2C%23ez-content-blocker-container%2C%23notify-adblock%7Bdisplay%3Anone!important%3Bmin-height%3A0!important%3Bheight%3A0!important%3B%7D" rel="stylesheet" type="text/css"></head>
<body>

<div id="wrapper">

<div id="page">

<div id="header">
		<h1><a href="https://tim.cexx.org/">Outguessing the machine</a></h1>
		<div class="description">the noise floor</div>
</div>

<div id="container">
	<div id="content">

	


  <div id="post-646" class="post-646 post type-post status-publish format-standard hentry category-general">
 

<div class="entry-date">
<div class="month">Aug</div>
<div class="day">17</div>
<div class="year">2009</div>
</div>

<h1 class="post-title">DIY-Spy: a homebrew 2.4GHz wi-fi spectrum analyzer</h1>


			<div class="entry">
				<p><object width="425" height="344"><param name="movie" value="http://www.youtube.com/v/PX6NwsiU8rQ&amp;hl=en&amp;fs=1&amp;"><param name="allowFullScreen" value="true"><param name="allowscriptaccess" value="always"><embed src="http://www.youtube.com/v/PX6NwsiU8rQ&amp;hl=en&amp;fs=1&amp;" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="425" height="344"></object></p>
<p>I was reading the Thinkgeek catalog a while back and an interesting 
gadget caught my eye: “Wi-Spy”, a 2.4GHz spectrum analyzer on a USB 
stick. Coming from the world where “spectrum analyzer” refers to a big 
benchtop box with a name like <strike>Le Croy</strike><sub>right, we can’t afford those</sub>
 Agilent on it, my first thought was, “A good spectrum analyzer in the 
GHz range is like a gazillion bucks; what’s really inside this thing?”</p>
<p>Not much, it turns out. After seeing the guts I would not use this 
device for anything remotely demanding accuracy, but on the bright side,
 it would be pretty straightforward to make your own that works just as 
well! Possibly with parts that are already on your board (*cough*XBee).</p>
<p>According to <a href="http://www.wireless-driver.com/reviews/MetaGeek-Wi-Spy-24-GHz-Spectrum-Analyzer.htm">this review</a>
 and a couple other tech sites, the innards of the original are nothing 
more than a Cypress WirelessUSB SoC (CYWUSB6934) and USB interface. 
According to <a href="http://www.smallnetbuilder.com/content/view/30072/96/">this updated review</a>, the latest version switches to TI/Chipcon’s CC2500 radio ($2.15 USD in quantity) and retails for $399.</p>
<p>The “WirelessUSB” and CC2500 radios are inexpensive 2.4GHz radio 
chips used in devices such as cordless mice, game controllers and remote
 controls. What it has in common with many other digital radios is an 
RSSI (Received Signal Strength Indication) register, which can be read 
out to provide a measure of how much signal (i.e. interference) is 
present on any given channel. Wireless gadgets normally use such a 
mechanism to find the cleanest channel to broadcast on. Most any radio 
chip with an RSSI readout should work here: XBee, TI/Chipcon’s CC25xx 
parts, Nordic, etc. I have a big nut going right now for Nordic’s 
nRF24L01, but unfortunately this does not have an RSSI measurement to 
speak of (there is a 1-bit “collision detect” flag that warns if the RF 
energy on the current channel is above a set threshold).</p>
<p>So essentially, the firmware running on the dongle consists of:</p>
<p>for (channel=0; channel&lt;255; channel++)<br>
{<br>
  WriteReg(RF_CHANNEL, channel);<br>
  signal=ReadReg(RSSI);<br>
  send_usb(signal);<br>
}</p>
<p>Hell, why didn’t I think of selling $2 of chip and 4 lines of code for $400? ;-) (I’ve even <a href="https://tim.cexx.org/?s=unigen">used those old Cypress radios before</a> on a work project – Unigen’s ready-made <a href="http://www.unigen.com/product_detail.php?pid=624">JUNO module</a> shown here is about 7 bucks.)</p>
<p><b>The DIY-Spy</b></p>
<p>As proof of concept (and a cool toy for anyone who has one of these 
lying around), I have implemented a working Wi-Fi spectrum analyzer on 
TI’s <a href="http://focus.ti.com/docs/toolsw/folders/print/ez430-rf2500.html">ez430-RF2500</a>
 development kit ($50), a 2-part USB dongle which consists essentially 
of a CC2500 radio strapped to an MSP430 low-power microcontroller 
(detachable bottom half) and a USB interface which enumerates as a 
virtual serial port (top half). The top half doubles as a standalone 
MSP430 programmer, so this kit is a great cheap way to get started 
playing with them.</p>
<p></p><center><img decoding="async" src="DIY-Spy%20a%20homebrew%202.4GHz%20wi-fi%20spectrum%20analyzer%20%C2%AB%20Outguessing%20the%20machine_files/ez430.jpg"></center><p></p>
<p>Being the <strike>lazy</strike> efficient person that I am, I grabbed <a href="http://mspgcc.sourceforge.net/">mspgcc</a> and an existing ez430 RF demo program (<a href="http://jmkikori.homepage.bluewin.ch/devel/ez430-rf2500.html">JM Kikori’s RF2500 test application – raw transceiver</a>) and just tossed the infinite RSSI loop into the middle of it.</p>
<p>Here is the main addition (simple &amp; sweet). Forgive WordPress’ complete mangling of the formatting.</p>
<p><code><br>
static void dump_rssi()<br>
{<br>
       int i;<br>
       char rssi;<br>
       for(i=0; i&lt;256; i++)<br>
       {<br>
              hal_spi_radio_writeReg( MRFI_CC2500_SPI_REG_CHANNR, i); // Channel number. Default spacing is ~200KHz/channel<br>
              hal_spi_radio_cmdStrobe( 0x34 );	// enter Rx mode (not needed except to start autocal)<br>
              rssi = (hal_spi_radio_readReg(MRFI_CC2500_SPI_REG_RSSI));<br>
              uart0_polled_putc((rssi&amp;0xFE) | (i==0)); // Cheap 
speed hack: write upper 7 bits of RSSI value (throw away LSB). Use LSB 
to signal start of 256-channel RSSI byte list<br>
              hal_spi_radio_cmdStrobe( 0x36 );	// enter IDLE mode (not needed except for autocal)<br>
        }<br>
}<br>
</code></p>
<p>The only real divergence of this from the pseudocode loop above is 
that the CC2500 requires periodic (or frequent, depending who you ask) 
recalibration, which can be set to be performed automatically on certain
 conditions (such as entering Rx mode). This setting is enabled, and the
 code above toggles between Rx and Idle modes between each channel 
change to trigger auto-calibration. To make things faster (for me as 
well as the gadget ;-), rather than perform any kind of real serial 
handshaking to keep the dongle and the graphing script in sync, I just 
truncate the least significant bit of the RSSI reading (1/2dBm) and use 
it to flag the start of the 256-channel sweep.</p>
<p>A more efficient approach would be to perform such calibration once 
per channel and cache the results (writing them back along with each 
channel change), which would in theory allow for much faster channel 
changes. But it’s really a moot point since here the 9600-baud 
connection to the virtual COM port (MSP430 &lt;–&gt; USB controller) is 
the limiter of maximum speed.</p>
<p>Most of the time in this project went into tweaking around with the 
CC2500’s fifty billion or so configuration register bits, not all of 
which are really documented. In the end I just installed their win32 
configuration wizard for the undocumented voodoo (e.g. correct IF 
setting) and annoying math, and hand-tweaked the remaining settings. For
 this I set the base frequency to 2400MHz, and the channel spacing to ~ 
405KHz, providing the frequency range 2400MHz to 2505MHz across the 256 
channel settings. This corresponds to the 2.4GHz ISM band and a little 
extra. All automatic gain control features are disabled.</p>
<p><b>Testing</b><br>
I’ve actually been sitting on this project now for a couple months, 
since I wasn’t getting the results I expected initially (sitting close 
to my WiFi access point) and had no good way to test it. Luckily, as it 
turns out I was tasked with developing some RF gadgets (nRF24L01-based) 
at work, which could easily be set up to output a raw carrier wave at a 
programmable frequency. Sure enough, testing revealed some bugs in my 
initial CC2500 register settings, now corrected.</p>
<p>The video above shows the resulting spectrum output as the nRF’s 
naked carrier is swept through a handful of frequencies. As it 
progresses, it should also become evident where my WiFi access point is 
broadcasting. The green lines show instantaneous signal, the red shows 
the peak value at each frequency, and the blue shows a running average. 
The display script is written in <a href="http://processing.org/">Processing</a>.</p>
<p></p><center><img decoding="async" src="DIY-Spy%20a%20homebrew%202.4GHz%20wi-fi%20spectrum%20analyzer%20%C2%AB%20Outguessing%20the%20machine_files/msp_nrf.jpg"></center><p></p>
<p><b>Downloads</b></p>
<p>Fairly undocumented; use at your own risk.<br>
<b><a href="https://tim.cexx.org/projects/diyspy/diyspy.zip">diyspy.zip</a></b>
 – Source code and .elf binary for ez430 kit (use mspgcc to build from 
source), .inf file for virtual COM port (win32 only), and Processing 
script for display.</p>

								
				<p class="postmetadata alt">
					<small>
						This entry was posted
												on Monday, August 17th, 2009 at 2:15 am						and is filed under <a href="https://tim.cexx.org/?cat=1" rel="category">General</a>.
						You can follow any responses to this entry through the <a href="https://tim.cexx.org/?feed=rss2&amp;p=646">RSS 2.0</a> feed.

													You can <a href="#respond">leave a response</a>, or <a href="https://tim.cexx.org/wp-trackback.php?p=646" rel="trackback">trackback</a> from your own site.

						
					</small>
				</p>

			</div>
		</div>

		<div class="navigation">
			<div class="alignleft">« <a href="https://tim.cexx.org/?p=656" rel="prev">Throwies overtake Kendall/MIT station sculpture</a></div>
			<div class="alignright"><a href="https://tim.cexx.org/?p=674" rel="next">My quickie guide for setting up mspgcc for ez430-cc2500</a> »</div>
            <div class="cb"></div>
		</div>
        
	
<!-- You can start editing here. -->

	<h3 id="comments">22 Responses to “DIY-Spy: a homebrew 2.4GHz wi-fi spectrum analyzer”</h3>

	<div class="navigation">
		<div class="alignleft"></div>
		<div class="alignright"></div>
	</div>

	<ol class="commentlist">
			<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-27831">
				<div id="div-comment-27831" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="DIY-Spy%20a%20homebrew%202.4GHz%20wi-fi%20spectrum%20analyzer%20%C2%AB%20Outguessing%20the%20machine_files/70458c3e5daaaa5b3976a62556149028.jpeg" srcset="DIY-Spy%20a%20homebrew%202.4GHz%20wi-fi%20spectrum%20analyzer%20%C2%AB%20Outguessing%20the%20machine_files/70458c3e5daaaa5b3976a62556149028_002.jpeg 2x" class="avatar avatar-32 photo" loading="lazy" decoding="async" width="32" height="32">			<cite class="fn">Clark</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata">
			<a href="https://tim.cexx.org/?p=646#comment-27831">8/18/2009 at 12:58 pm</a>		</div>

		</div></li></ol></div></div></div></div></body></html>